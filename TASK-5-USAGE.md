# CopyAllQuestion 模块使用说明

## 功能说明

一键复制超星网页上的所有题目内容，支持：
- 单选题、多选题、简答题等多种题型
- 自动提取题目标题和选项
- 选项自动格式化为 A/B/C/D 格式
- 支持跨 iframe 收集题目
- 可编辑预览后再复制

## 使用方法

### 1. 在超星网页上查找按钮

当你打开包含题目的超星页面时，扩展会自动在"章节详情"标题后插入一个蓝色按钮：

```
章节详情
[点击复制所有题目]  ← 这个按钮
```

### 2. 点击按钮收集题目

点击"点击复制所有题目"按钮后：
- 扩展会自动收集当前页面的所有题目
- 同时收集页面中所有 iframe 里的题目
- 收集过程可能需要几秒钟

### 3. 预览和编辑

收集完成后会弹出模态框，显示所有题目：

```
# 章节标题

1. 第一道题目的标题
A. 选项1
B. 选项2
C. 选项3
D. 选项4

2. 第二道题目的标题
A. 选项1
B. 选项2
...
```

你可以在文本框中：
- 查看所有收集到的题目
- 手动编辑内容
- 删除不需要的题目

### 4. 一键复制

点击模态框底部的"一键复制"按钮：
- 内容会被复制到剪贴板
- 显示"已复制题目内容"提示
- 模态框自动关闭

然后你可以粘贴到：
- 文本编辑器
- Word 文档
- 笔记软件
- 搜索引擎

## 题目格式说明

### 选择题格式
```
1. 题目标题
A. 选项1
B. 选项2
C. 选项3
D. 选项4
```

### 简答题格式
```
1. 题目标题

```

### 多个章节
```
# 第一章

1. 题目1
...

# 第二章

1. 题目1
...
```

## 支持的页面类型

- ✅ 章节作业页面
- ✅ 考试页面
- ✅ 练习页面
- ✅ 包含 iframe 的复杂页面
- ✅ 跨域 iframe（通过 postMessage 通信）

## 注意事项

1. **按钮位置**：按钮只会在包含"章节详情"的 `<h2>` 标题后出现
2. **题目识别**：扩展会查找 `.TiMu` 容器和 `.Zy_TItle` 标题
3. **加密字体**：如果题目使用了加密字体，请确保字体解密功能已启用
4. **iframe 超时**：跨域 iframe 收集有 3 秒超时限制，超时会跳过该 iframe
5. **编辑功能**：可以在模态框中手动编辑题目内容后再复制

## 故障排除

### 问题：没有看到"点击复制所有题目"按钮

**可能原因**：
- 页面没有"章节详情"标题
- 页面还在加载中
- 扩展未正确加载

**解决方法**：
1. 刷新页面
2. 检查页面是否有 `<h2>章节详情</h2>` 标签
3. 打开开发者工具查看是否有错误

### 问题：点击按钮后没有反应

**可能原因**：
- 页面没有题目
- 题目结构不符合预期

**解决方法**：
1. 打开开发者工具查看控制台
2. 检查页面是否有 `.TiMu` 容器
3. 尝试手动刷新页面

### 问题：收集到的题目不完整

**可能原因**：
- 某些 iframe 是跨域的且超时
- 题目结构特殊

**解决方法**：
1. 多点击几次按钮重试
2. 在模态框中手动补充缺失的题目
3. 分别在不同页面收集

## 技术细节

### 题目提取选择器

扩展会按以下优先级查找题目：

1. `.Zy_TItle .fontLabel` - 加密字体标题
2. `.Zy_Title .fontLabel` - 加密字体标题（备用拼写）
3. `.newZy_TItle .fontLabel` - 新版加密字体标题
4. `.Zy_TItle` - 普通标题
5. `.TiMu .Zy_TItle` - 题目容器中的标题

### 选项提取选择器

- `ul.Zy_ulTop.w-top.fl > li > p` - 选项列表

### 跨域通信

使用 `postMessage` API 与跨域 iframe 通信：
- 请求类型：`CX_GET_TITLES`
- 响应类型：`CX_TITLES_RESPONSE`
- 超时时间：3000ms
- 域名验证：仅响应 `*.chaoxing.com` 域名
